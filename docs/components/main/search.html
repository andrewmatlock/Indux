<dialog popover id="search" class="w-1/2 h-2/3" x-data="{ searchQuery: '' }">

    <header class="gap-0 h-fit pl-0 py-0 bg-content-subtle/10">
        <label role="button" class="no-focus h-16 pl-2 bg-transparent rounded-none">
            <span x-icon="lucide:search"></span>
            <input type="search" placeholder="Search" x-model="searchQuery" />
        </label>
      <button popovertarget="search" popoveraction="hide" class="outlined ghost text-sm">esc</button>
    </header>

    <main class="p-4">
        <!-- Search results using x-search directive -->
        <div x-search="searchQuery">
            <template>
                <div class="search-result p-2 border-b border-content-subtle/20 hover:bg-content-subtle/5">
                    <h4 class="font-medium text-content-strong" x-text="result.title"></h4>
                    <p class="text-sm text-content-muted mt-1" x-text="result.excerpt"></p>
                    <a :href="result.url" class="text-xs text-primary mt-1 block" x-text="result.url"></a>
                </div>
            </template>
        </div>
        
        <!-- No results message -->
        <div x-show="searchQuery && searchQuery.length > 0 && $search.results.length === 0" class="text-center text-content-muted py-8">
            <span x-icon="lucide:search-x" class="text-4xl mb-2 block"></span>
            <p>No results found for "<span x-text="searchQuery"></span>"</p>
        </div>
        
        <!-- Empty state -->
        <div x-show="!searchQuery || searchQuery.length === 0" class="text-center text-content-muted py-8">
            <span x-icon="lucide:search" class="text-4xl mb-2 block"></span>
            <p>Start typing to search...</p>
        </div>
    </main>

</dialog>

<script>
// Toggle search modal with Cmd+K or Ctrl+K
document.addEventListener('keydown', (event) => {
    if ((event.metaKey || event.ctrlKey) && event.key === 'k') {
        event.preventDefault();
        
        const searchElement = document.getElementById('search');
        if (searchElement) {
            // Check if element has popover attribute and method is supported
            if (searchElement.hasAttribute('popover') && typeof searchElement.togglePopover === 'function') {
                try {
                    searchElement.togglePopover();
                } catch (error) {
                    console.error('Error toggling search popover:', error);
                    // Fallback: try to focus the input if popover fails
                    const searchInput = searchElement.querySelector('input[type="search"]');
                    if (searchInput) {
                        searchInput.focus();
                    }
                }
            } else {
                console.warn('Search element is not a popover or togglePopover is not supported');
                // Fallback: try to focus the input
                const searchInput = searchElement.querySelector('input[type="search"]');
                if (searchInput) {
                    searchInput.focus();
                }
            }
        }
    }
});
</script>
